<div class="actions-main-container d-flex">
	<ng-container *ngIf="currentMode == userModeEnum.READ">
		<div class="d-flex gap-2 container-read">
			<div
				[formGroup]="searchFormGroup"
				class="search d-flex flex-row gap-1"
			>
				<input
					formControlName="search"
					type="text"
					placeholder="Cerca..."
				/>

				<i
					class="bi bi-x-lg"
					*ngIf="onSearch"
					(click)="restoreSearch()"
				></i>
				<i class="bi bi-search" *ngIf="!onSearch"></i>
			</div>

			<div class="filers-container gap-1" [class.no-logged]="!userLogged">
				<select
					class="form-select form-select-sm filter-by"
					aria-label="Small select example"
					*ngIf="userLogged"
					[(ngModel)]="currentFilter"
					(ngModelChange)="setFilterBy($event)"
				>
					<option selected [value]="filterBooksEnum.NONE">
						Filtra per
					</option>
					<option [value]="filterBooksEnum.BOOKS_NO_REQUESTORS">
						Libri senza richiedenti
					</option>
					<option [value]="filterBooksEnum.BOOKS_REQUESTORS">
						Libri con richiedenti
					</option>
					<option [value]="filterBooksEnum.BOOKS_DISABLED">
						Libri disabilitati
					</option>
				</select>

				<select
					class="form-select form-select-sm filter-by"
					aria-label="Small select example"
					[(ngModel)]="currentOrder"
					(ngModelChange)="setOrderBy($event)"
				>
					<option selected [value]="orderBooksEnum.TITLE">Titolo</option>
					<option [value]="orderBooksEnum.AUTHOR">Autore</option>
                    <option [value]="orderBooksEnum.TOPIC">Argomento</option>
					<option [value]="orderBooksEnum.PLACE">Luogo</option>
				</select>
			</div>

            <div class="d-flex flex-row gap-2">
                <a class="btn btn-question d-flex" routerLink="/tutorial">
                    <i class="bi bi-question-lg"></i>
                </a>
    
                <button
                    *ngIf="!userLogged"
                    class="btn btn-booking btn-secondary"
                    data-bs-toggle="modal"
                    data-bs-target="#bookingModal"
                >
                    Prenota libro
                </button>

                <div class="action-buttons-container" *ngIf="userLogged">
                    <button
                        class="btn btn-new btn-secondary"
                        (click)="setMode(userModeEnum.NEW)"
                    >
                        Crea
                    </button>
    
                    <button
                        class="btn btn-edit btn-secondary"
                        (click)="setMode(userModeEnum.MANAGE)"
                        *ngIf="false"
                    >
                        Gestisci
                    </button>
    
                    <button
                        class="btn btn-edit btn-secondary"
                        (click)="setMode(userModeEnum.EDIT)"
                    >
                        Modifica
                    </button>
    
                    <button
                        class="btn btn-export btn-secondary"
                        (click)="execAction(actionEnum.EXPORT)"
                    >
                        Esporta
                    </button>
                </div>
            </div>
		</div>
	</ng-container>

	<!-- Modal -->
	<div
		class="modal fade"
		id="bookingModal"
		tabindex="-1"
		aria-labelledby="bookingModelLabel"
		aria-hidden="true"
	>
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title" id="bookingModelLabel">
						Prenotazione libro
					</h5>
					<button
						type="button"
						class="btn-close"
						data-bs-dismiss="modal"
						aria-label="Close"
					></button>
				</div>
				<div class="modal-body">
					<div class="book-info d-flex flex-column gap-2">
						<div class="book-field">
							<div class="field-title">Titolo</div>
							<div class="field-value">
								{{ selectedBook?.title }}
							</div>
						</div>
						<div class="book-field">
							<div class="field-title">Autore</div>
							<div class="field-value">
								{{ selectedBook?.authors }}
							</div>
						</div>
						<div class="book-field">
							<div class="field-title">Argomento</div>
							<div class="field-value">
								{{ selectedBook?.topic }}
							</div>
						</div>
						<div class="book-field">
							<div class="field-title">Anno</div>
							<div class="field-value">
								{{ selectedBook?.year }}
							</div>
						</div>
						<div class="book-field">
							<div class="field-title">Totale richiedenti</div>
							<div class="field-value">
								{{ selectedBook?.requestor?.length }}
							</div>
						</div>
					</div>

					<hr />

					<div class="requestor-info d-flex flex-column">
						<label class="field-title"
							>Cognome, Nome del richiedente
                        </label>
						<input
							type="text"
							class="form-control"
							[(ngModel)]="possibleRequestor"
						/>
					</div>
				</div>
				<div class="modal-footer">
					<button
						type="button"
						class="btn btn-secondary cancel"
						data-bs-dismiss="modal"
					>
						Anulla
					</button>
					<button
						type="button"
						class="btn btn-primary booking submit"
						data-bs-dismiss="modal"
						(click)="bookBooking()"
					>
						Prenota
					</button>
				</div>
			</div>
		</div>
	</div>
</div>
